<section class="rounded-3xl border border-white/10 bg-gradient-to-br from-white/5 to-white/0 p-8 md:p-12">
  <p class="text-cyan-300 text-sm tracking-wide">BÚSQUEDA</p>
  <h1 class="mt-3 text-4xl md:text-5xl font-extrabold">Búsqueda simple + avanzada</h1>
  <p class="mt-4 text-slate-300 max-w-3xl">
    Prueba el buscador consumiendo la API <code class="text-cyan-300">/api/search</code>. Si no envías filtros funciona como simple, si envías filtros es avanzada.
  </p>

  <div class="mt-8 grid md:grid-cols-3 gap-4">
    <div class="md:col-span-2 rounded-2xl border border-white/10 bg-white/5 p-5">
      <label class="text-sm text-slate-300">Búsqueda (q)</label>
      <div class="mt-2 flex gap-2">
        <input id="q" class="w-full rounded-xl bg-slate-950/60 border border-white/10 px-4 py-3 outline-none focus:border-cyan-400/40"
               placeholder="Ej: aceite, frenos, alineación, motor..." />
        <button id="btnBuscar" class="px-5 py-3 rounded-xl bg-gradient-to-r from-cyan-400 to-indigo-500 text-slate-950 font-semibold">
          Buscar
        </button>
      </div>

      <div class="mt-4 flex flex-wrap gap-2 text-xs text-slate-300">
        <button class="chip px-3 py-1 rounded-full bg-white/10 border border-white/10" data-q="aceite">aceite</button>
        <button class="chip px-3 py-1 rounded-full bg-white/10 border border-white/10" data-q="frenos">frenos</button>
        <button class="chip px-3 py-1 rounded-full bg-white/10 border border-white/10" data-q="alineacion">alineación</button>
        <button class="chip px-3 py-1 rounded-full bg-white/10 border border-white/10" data-q="motor">motor</button>
      </div>
    </div>

    <div class="rounded-2xl border border-white/10 bg-white/5 p-5">
      <h3 class="font-semibold">Avanzada</h3>

      <label class="mt-3 block text-sm text-slate-300">Categoría</label>
      <select id="category" class="mt-2 w-full rounded-xl bg-slate-950/60 border border-white/10 px-4 py-3 outline-none focus:border-cyan-400/40">
        <option value="">Todas</option>
        <option value="mantenimiento">Mantenimiento</option>
        <option value="frenos">Frenos</option>
        <option value="llantas">Llantas</option>
        <option value="electrico">Eléctrico</option>
      </select>

      <div class="mt-4 grid grid-cols-2 gap-2">
        <div>
          <label class="block text-sm text-slate-300">Min</label>
          <input id="min" type="number" class="mt-2 w-full rounded-xl bg-slate-950/60 border border-white/10 px-4 py-3 outline-none focus:border-cyan-400/40" placeholder="0" />
        </div>
        <div>
          <label class="block text-sm text-slate-300">Max</label>
          <input id="max" type="number" class="mt-2 w-full rounded-xl bg-slate-950/60 border border-white/10 px-4 py-3 outline-none focus:border-cyan-400/40" placeholder="2000" />
        </div>
      </div>

      <label class="mt-4 block text-sm text-slate-300">Tags (coma separada)</label>
      <input id="tags" class="mt-2 w-full rounded-xl bg-slate-950/60 border border-white/10 px-4 py-3 outline-none focus:border-cyan-400/40"
             placeholder="ej: aceite,motor" />

      <label class="mt-4 block text-sm text-slate-300">Orden</label>
      <select id="sort" class="mt-2 w-full rounded-xl bg-slate-950/60 border border-white/10 px-4 py-3 outline-none focus:border-cyan-400/40">
        <option value="relevance">Relevancia</option>
        <option value="newest">Más recientes</option>
        <option value="price_asc">Precio ↑</option>
        <option value="price_desc">Precio ↓</option>
      </select>

      <div class="mt-4 flex gap-2">
        <button id="btnLimpiar" class="w-full px-4 py-3 rounded-xl bg-white/10 hover:bg-white/15 border border-white/10">
          Limpiar
        </button>
      </div>
    </div>
  </div>

  <div class="mt-8 flex items-center justify-between">
    <div id="status" class="text-sm text-slate-400">Listo para buscar.</div>
    <div class="text-xs text-slate-500">API: /api/search</div>
  </div>

  <div id="resultados" class="mt-5 grid md:grid-cols-2 gap-4"></div>

  <div class="mt-8 flex items-center justify-between">
    <button id="prev" class="px-4 py-2 rounded-xl bg-white/10 hover:bg-white/15 border border-white/10">← Prev</button>
    <div id="paginacion" class="text-sm text-slate-300">Página 1</div>
    <button id="next" class="px-4 py-2 rounded-xl bg-white/10 hover:bg-white/15 border border-white/10">Next →</button>
  </div>
</section>

<script>
  let page = 1;
  const limit = 10;

  const $ = (id) => document.getElementById(id);

  function buildQuery() {
    const q = $("q").value.trim();
    const category = $("category").value.trim();
    const min = $("min").value.trim();
    const max = $("max").value.trim();
    const tags = $("tags").value.trim();
    const sort = $("sort").value.trim();

    const params = new URLSearchParams();
    if (q) params.set("q", q);
    if (category) params.set("category", category);
    if (min) params.set("min", min);
    if (max) params.set("max", max);
    if (tags) params.set("tags", tags);
    if (sort) params.set("sort", sort);
    params.set("page", String(page));
    params.set("limit", String(limit));
    return params.toString();
  }

  function card(item) {
    return `
      <div class="rounded-2xl border border-white/10 bg-white/5 p-5 hover:bg-white/10 transition">
        <div class="flex items-start justify-between gap-3">
          <div>
            <p class="text-xs text-cyan-300">${item.category || ""}</p>
            <h3 class="text-lg font-semibold">${item.title}</h3>
            <p class="mt-2 text-slate-300 text-sm">${item.snippet}...</p>
          </div>
          <div class="text-right">
            <div class="text-sm text-slate-400">Precio</div>
            <div class="text-xl font-extrabold">$${item.price}</div>
          </div>
        </div>
        <div class="mt-3 flex flex-wrap gap-2">
          ${(item.tags || []).map(t => `<span class="text-xs px-2 py-1 rounded-full bg-white/10 border border-white/10">${t}</span>`).join("")}
        </div>
        <div class="mt-4 text-xs text-slate-500">Fecha: ${item.date}</div>
      </div>
    `;
  }

  async function buscar() {
    $("status").textContent = "Buscando...";
    $("resultados").innerHTML = "";
    $("paginacion").textContent = `Página ${page}`;

    const qs = buildQuery();
    const url = "/api/search?" + qs;

    const res = await fetch(url);
    const data = await res.json();

    $("status").textContent = `Resultados: ${data.total}`;
    $("paginacion").textContent = `Página ${data.page} · Mostrando ${data.items.length} de ${data.total}`;

    if (!data.items.length) {
      $("resultados").innerHTML = `
        <div class="md:col-span-2 rounded-2xl border border-white/10 bg-slate-900/40 p-6 text-slate-300">
          No se encontraron resultados. Prueba con otro término o ajusta filtros.
        </div>`;
      return;
    }

    $("resultados").innerHTML = data.items.map(card).join("");
  }

  $("btnBuscar").addEventListener("click", () => { page = 1; buscar(); });
  $("btnLimpiar").addEventListener("click", () => {
    $("q").value = "";
    $("category").value = "";
    $("min").value = "";
    $("max").value = "";
    $("tags").value = "";
    $("sort").value = "relevance";
    page = 1;
    buscar();
  });

  document.querySelectorAll(".chip").forEach(btn => {
    btn.addEventListener("click", () => {
      $("q").value = btn.dataset.q;
      page = 1;
      buscar();
    });
  });

  $("prev").addEventListener("click", () => {
    if (page > 1) { page--; buscar(); }
  });

  $("next").addEventListener("click", () => {
    page++; buscar();
  });

  // primera carga
  buscar();
</script>
